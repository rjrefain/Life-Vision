<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Video Production Tracker</title>
  <style>
    :root {
      --primary-color: #667eea;
      --secondary-color: #764ba2;
      --success-color: #27ae60;
      --danger-color: #e74c3c;
      --dark-color: #2c3e50;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      min-height: 100vh;
      color: var(--dark-color);
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
    }

    /* Header */
    .header {
      background: white;
      padding: 25px;
      border-bottom: 1px solid #e8ecf0;
    }

    h1 {
      text-align: center;
      font-size: 2.2em;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--dark-color);
    }

    .header-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    #currentDateTime {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: 600;
    }

    .nav-links {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .nav-btn {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
    }

    /* Control Bar */
    .control-bar {
      background: #f8f9fa;
      padding: 20px 25px;
      border-bottom: 1px solid #e8ecf0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .status-indicator {
      background: linear-gradient(135deg, #00d2ff, #3a7bd5);
      color: white;
      padding: 10px 18px;
      border-radius: 25px;
      font-weight: 600;
      box-shadow: 0 6px 20px rgba(58, 123, 213, 0.3);
    }

    .control-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 25px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .reset-btn {
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
      box-shadow: 0 6px 20px rgba(238, 90, 36, 0.3);
    }

    .reset-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(238, 90, 36, 0.5);
    }

    .reset-btn:disabled {
      background: #95a5a6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .dropdown-wrapper {
      position: relative;
      z-index: 9999;
    }

    .reorder-btn {
      background: linear-gradient(135deg, #a8e6cf, #56ab2f);
      color: white;
      box-shadow: 0 6px 20px rgba(86, 171, 47, 0.3);
    }

    .reorder-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(86, 171, 47, 0.5);
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: 15px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      z-index: 10000;
      min-width: 220px;
      margin-top: 8px;
      overflow: hidden;
      display: none;
    }

    .dropdown-menu.show {
      display: block;
      animation: dropdownSlide 0.3s ease;
    }

    @keyframes dropdownSlide {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .dropdown-item {
      padding: 15px 20px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-weight: 500;
      color: var(--dark-color);
      border-bottom: 1px solid #e8ecf0;
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background-color: #f8f9fa;
      color: var(--primary-color);
    }

    /* Main Content */
    .main-content {
      padding: 25px;
    }

    /* Form Section */
    .form-section {
      background: #f8f9fa;
      border-radius: 15px;
      margin-bottom: 30px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    .form-header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 15px 20px;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      transition: all 0.3s ease;
    }

    .form-header:hover {
      background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
    }

    .form-body {
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
      background: white;
    }

    .form-body.expanded {
      max-height: 500px;
      padding: 30px;
    }

    .form-body input {
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 15px;
      border: 2px solid #e8ecf0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .form-body input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
    }

    .form-body button {
      width: 100%;
      background: linear-gradient(135deg, var(--success-color), #2ecc71);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .form-body button:hover {
      background: linear-gradient(135deg, #219150, #27ae60);
      transform: translateY(-1px);
    }

    /* Table */
    .table-container {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
    }

    th:nth-child(4) {
      text-align: center;
    }

    td {
      padding: 15px;
      border-bottom: 1px solid #e8ecf0;
    }

    td:nth-child(4) {
      text-align: center;
      font-weight: bold;
      font-size: 1.1em;
      color: var(--primary-color);
    }

    tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    tr:hover {
      background-color: #e3f2fd;
    }

    .draggable-row {
      cursor: move;
      transition: all 0.3s ease;
    }

    .draggable-row:hover {
      background-color: #e3f2fd !important;
    }

    .draggable-row.dragging {
      opacity: 0.5;
      transform: scale(1.02);
      z-index: 1000;
    }

    .drag-handle {
      color: var(--primary-color);
      font-size: 16px;
      opacity: 0.7;
      cursor: grab;
      margin-right: 8px;
    }

    .drag-handle:active {
      cursor: grabbing;
    }

    .draggable-row:hover .drag-handle {
      opacity: 1;
    }

    .channel-content {
      display: flex;
      align-items: center;
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 15px;
      font-weight: 600;
      font-size: 0.8em;
      text-transform: uppercase;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-completed {
      background: #d4edda;
      color: #155724;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .status-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
    }

    .status-btn.completed {
      background: linear-gradient(135deg, var(--success-color), #2ecc71);
    }

    .delete-btn {
      background: var(--danger-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .delete-btn:hover {
      background: #c0392b;
      transform: scale(1.1);
    }

    .edit-pencil {
      color: var(--primary-color);
      cursor: pointer;
      margin-left: 8px;
      opacity: 0.7;
      transition: all 0.3s ease;
    }

    .edit-pencil:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .edit-input {
      padding: 4px 8px;
      border: 2px solid var(--primary-color);
      border-radius: 4px;
      font-size: 14px;
    }

    .edit-actions {
      display: flex;
      gap: 5px;
    }

    .edit-btn {
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      font-weight: 600;
      cursor: pointer;
      font-size: 12px;
    }

    .save-btn {
      background: var(--success-color);
      color: white;
    }

    .cancel-btn {
      background: var(--danger-color);
      color: white;
    }

    /* Celebration Modal */
    .celebration-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 20000;
      backdrop-filter: blur(10px);
    }

    .celebration-modal.show {
      display: flex;
      animation: modalFadeIn 0.5s ease;
    }

    @keyframes modalFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .celebration-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 90%;
      animation: celebrationPop 0.6s ease forwards;
    }

    @keyframes celebrationPop {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    .celebration-icon {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      font-size: 48px;
      color: white;
      animation: bounce 1.5s infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-20px); }
      60% { transform: translateY(-10px); }
    }

    .celebration-title {
      color: white;
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .celebration-message {
      color: white;
      font-size: 18px;
      margin-bottom: 25px;
    }

    .celebration-close {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid white;
      padding: 10px 25px;
      border-radius: 20px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .celebration-close:hover {
      background: white;
      color: var(--primary-color);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .container {
        margin: 10px;
      }

      .header {
        padding: 15px;
      }

      .header-nav {
        flex-direction: column;
        gap: 10px;
      }

      .control-bar {
        flex-direction: column;
        gap: 15px;
        padding: 15px;
      }

      .main-content {
        padding: 15px;
      }

      table, thead, tbody, th, td, tr {
        display: block;
      }

      thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
      }

      tr {
        border: 1px solid #ccc;
        border-radius: 10px;
        margin-bottom: 15px;
        padding: 15px;
        background: white;
      }

      td {
        border: none;
        padding: 10px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      td::before {
        content: attr(data-label);
        font-weight: bold;
        color: var(--primary-color);
        min-width: 100px;
      }

      .action-buttons {
        flex-direction: column;
        width: 100%;
      }

      .status-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>Video Production Tracker</h1>
      <div class="header-nav">
        <div id="currentDateTime">Loading time...</div>
        <div class="nav-links">
          <a href="task-dashboard.html" class="nav-btn">Manager Task</a>
          <a href="channel-status-tracker.html" class="nav-btn">📊 Channel Status</a>
          <a href="payment_tracker.html" class="nav-btn">💰 Payment Tracker</a>
        </div>
      </div>
    </div>

    <!-- Control Bar -->
    <div class="control-bar">
      <div class="status-indicator" id="statusIndicator">
        🟢 Connected to Database
      </div>
      
      <button class="control-btn reset-btn" onclick="resetAllChannels()" id="resetBtn">
        🔄 Reset All Channels
      </button>
      
      <div class="dropdown-wrapper">
        <button class="control-btn reorder-btn" onclick="toggleDropdown()">
          🔄 Auto Reorder ▼
        </button>
        <div class="dropdown-menu" id="dropdownMenu">
          <div class="dropdown-item" onclick="reorderBy('collaborator')">
            👥 Collaborator Arrangement
          </div>
          <div class="dropdown-item" onclick="reorderBy('project')">
            📁 Project Arrangement
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Add Channel Form -->
      <div class="form-section">
        <div class="form-header" onclick="toggleForm()">
          ➕ Add New Channel
          <span id="formToggleIcon">▼</span>
        </div>
        <div class="form-body" id="formBody">
          <input type="text" id="channelId" placeholder="Channel ID (e.g. my-channel)" required />
          <input type="text" id="channelName" placeholder="Channel Name" required />
          <input type="text" id="client" placeholder="Client Name" />
          <input type="text" id="collaborator" placeholder="Collaborator Name" />
          <input type="number" id="monthlyVideos" placeholder="Videos Per Month" min="0" />
          <button onclick="addChannel()">Create Channel</button>
        </div>
      </div>

      <!-- Table -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Channel</th>
              <th>Client</th>
              <th>Collaborator</th>
              <th>Videos/Month</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="tasksBody">
            <!-- Table content will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Celebration Modal -->
    <div class="celebration-modal" id="celebrationModal">
      <div class="celebration-content">
        <div class="celebration-icon">✓</div>
        <h2 class="celebration-title">CONGRATULATIONS!</h2>
        <p class="celebration-message">
          You Are Helping LemonCore To Grow, Keep That Up Champ!
        </p>
        <button class="celebration-close" onclick="closeCelebration()">
          ✨ Continue The Great Work! ✨
        </button>
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2'

    const supabaseUrl = 'https://prkrbswttmtgeplsvzlj.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBya3Jic3d0dG10Z2VwbHN2emxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNTk5NjQsImV4cCI6MjA3MjYzNTk2NH0.Ul2cd-cpWHfpK1HTgHM7Tv2NDCrFWcAq2N-C7Tv9oz8'
    const supabase = createClient(supabaseUrl, supabaseKey)

    let tasks = [];
    let channelOrder = [];
    let draggedElement = null;

    // Initialize
    function init() {
      updateDateTime();
      setInterval(updateDateTime, 1000);
      loadTasks();
      
      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.dropdown-wrapper')) {
          document.getElementById('dropdownMenu').classList.remove('show');
        }
      });
    }

    function updateDateTime() {
      const now = new Date();
      const bdt = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Dhaka' }));
      document.getElementById('currentDateTime').textContent = bdt.toLocaleString('en-US', {
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
    }

    async function loadTasks() {
      try {
        // Load channel order
        const { data: orderData } = await supabase
          .from('channel_order')
          .select('*')
          .order('order_position');
        
        channelOrder = orderData || [];
        
        // Load tasks
        const { data: tasksData, error } = await supabase
          .from('tasks')
          .select('*');
        
        if (error) throw error;
        
        tasks = tasksData || [];
        renderTasks();
        
        document.getElementById('statusIndicator').innerHTML = '🟢 Connected to Database';
      } catch (error) {
        console.error('Error adding channel:', error);
        if (error.code === '23505') {
          alert('❌ Channel ID already exists. Please use a different ID.');
        } else {
          alert('❌ Failed to add channel. Please try again.');
        }
      }
    };

    window.toggleTask = async function(id) {
      try {
        const task = tasks.find(t => t.id === id);
        if (!task) return;
        
        const newStatus = task.status === 'completed' ? 'pending' : 'completed';
        
        const { error } = await supabase
          .from('tasks')
          .update({ 
            status: newStatus, 
            last_updated: new Date().toISOString() 
          })
          .eq('id', id);
        
        if (error) throw error;
        
        task.status = newStatus;
        renderTasks();
        
        if (newStatus === 'completed') {
          showCelebration();
        }
      } catch (error) {
        console.error('Error updating task:', error);
        alert('❌ Failed to update task status');
      }
    };

    window.deleteChannel = async function(id) {
      if (confirm("Are you sure you want to delete this channel?")) {
        try {
          const { error } = await supabase
            .from('tasks')
            .delete()
            .eq('id', id);
          
          if (error) throw error;
          
          tasks = tasks.filter(t => t.id !== id);
          renderTasks();
          
          // Also remove from channel order
          await supabase
            .from('channel_order')
            .delete()
            .eq('channel_id', id);
          
          channelOrder = channelOrder.filter(o => o.channel_id !== id);
          
        } catch (error) {
          console.error('Error deleting channel:', error);
          alert('❌ Failed to delete channel');
        }
      }
    };

    window.editRow = function(id) {
      // Simple edit functionality - you can expand this
      const newName = prompt('Enter new channel name:');
      if (newName && newName.trim()) {
        updateChannelName(id, newName.trim());
      }
    };

    async function updateChannelName(id, newName) {
      try {
        const { error } = await supabase
          .from('tasks')
          .update({ 
            channel: newName,
            last_updated: new Date().toISOString() 
          })
          .eq('id', id);
        
        if (error) throw error;
        
        const task = tasks.find(t => t.id === id);
        if (task) {
          task.channel = newName;
          renderTasks();
        }
        
        alert('✅ Channel name updated successfully!');
      } catch (error) {
        console.error('Error updating channel:', error);
        alert('❌ Failed to update channel name');
      }
    }

    window.resetAllChannels = async function() {
      const confirmation = confirm(
        "🔄 Are you sure you want to reset ALL channels?\n\n" +
        "This will change all completed channels back to pending status.\n\n" +
        "Continue with reset?"
      );
      
      if (!confirmation) return;

      const resetBtn = document.getElementById('resetBtn');
      resetBtn.disabled = true;
      resetBtn.textContent = '🔄 Resetting...';

      try {
        const { error } = await supabase
          .from('tasks')
          .update({ 
            status: 'pending',
            last_updated: new Date().toISOString()
          })
          .eq('status', 'completed');

        if (error) throw error;

        tasks.forEach(task => {
          if (task.status === 'completed') {
            task.status = 'pending';
          }
        });

        renderTasks();
        alert('✅ All channels have been reset to pending status!');
      } catch (error) {
        console.error('Error resetting channels:', error);
        alert('❌ Error resetting channels. Please try again.');
      } finally {
        resetBtn.disabled = false;
        resetBtn.textContent = '🔄 Reset All Channels';
      }
    };

    window.toggleDropdown = function() {
      const dropdown = document.getElementById('dropdownMenu');
      dropdown.classList.toggle('show');
    };

    window.reorderBy = async function(type) {
      const dropdown = document.getElementById('dropdownMenu');
      dropdown.classList.remove('show');
      
      try {
        const { data: fetchedTasks, error } = await supabase
          .from('tasks')
          .select('*')
        
        if (error) throw error;

        let sortedTasks;
        
        if (type === 'collaborator') {
          sortedTasks = fetchedTasks.sort((a, b) => {
            const collabA = (a.collaborator || 'Unassigned').toLowerCase();
            const collabB = (b.collaborator || 'Unassigned').toLowerCase();
            if (collabA === collabB) {
              return a.channel.toLowerCase().localeCompare(b.channel.toLowerCase());
            }
            return collabA.localeCompare(collabB);
          });
        } else if (type === 'project') {
          sortedTasks = fetchedTasks.sort((a, b) => {
            return a.channel.toLowerCase().localeCompare(b.channel.toLowerCase());
          });
        }
        
        const newOrder = sortedTasks.map((task, index) => ({
          channel_id: task.id,
          order_position: index
        }));
        
        await supabase.from('channel_order').delete().gt('id', 0);
        await supabase.from('channel_order').insert(newOrder);
        
        channelOrder = newOrder;
        await loadTasks();
        
        const orderType = type === 'collaborator' ? 'Collaborator' : 'Project';
        alert(`✅ Channels reordered by ${orderType} successfully!`);
      } catch (error) {
        console.error('Error reordering:', error);
        alert('❌ Failed to reorder channels');
      }
    };

    window.showCelebration = function() {
      const modal = document.getElementById('celebrationModal');
      modal.classList.add('show');
      
      setTimeout(() => {
        closeCelebration();
      }, 5000);
    };

    window.closeCelebration = function() {
      const modal = document.getElementById('celebrationModal');
      modal.classList.remove('show');
    };

    // Initialize the app
    init();
  </script>
</body>
</html>
        console.error('Error loading tasks:', error);
        document.getElementById('statusIndicator').innerHTML = '🔴 Connection Error';
      }
    }

    function sortChannelsByOrder(tasks) {
      if (channelOrder.length === 0) {
        return tasks;
      }
      
      const orderMap = {};
      channelOrder.forEach(item => {
        orderMap[item.channel_id] = item.order_position;
      });
      
      return [...tasks].sort((a, b) => {
        const orderA = orderMap[a.id] !== undefined ? orderMap[a.id] : 999;
        const orderB = orderMap[b.id] !== undefined ? orderMap[b.id] : 999;
        return orderA - orderB;
      });
    }

    function renderTasks() {
      const tbody = document.getElementById('tasksBody');
      
      if (tasks.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px;">No channels found. Add a channel to get started.</td></tr>';
        return;
      }

      const sortedTasks = sortChannelsByOrder(tasks);
      
      tbody.innerHTML = sortedTasks.map(task => `
        <tr class="draggable-row" data-channel-id="${task.id}" draggable="true">
          <td data-label="Channel">
            <div class="channel-content">
              <span class="drag-handle">⋮⋮</span>
              <span class="channel-name">${task.channel}</span>
              <span class="edit-pencil" onclick="editRow('${task.id}')" title="Edit">✏️</span>
            </div>
          </td>
          <td data-label="Client">${task.client || 'Not specified'}</td>
          <td data-label="Collaborator">${task.collaborator || 'Unassigned'}</td>
          <td data-label="Videos/Month">${task.daily_videos || 0}</td>
          <td data-label="Status">
            <span class="status-badge status-${task.status}">
              ${task.status.toUpperCase()}
            </span>
          </td>
          <td data-label="Action">
            <div class="action-buttons">
              <button class="status-btn ${task.status === 'completed' ? 'completed' : ''}" 
                      onclick="toggleTask('${task.id}')">
                ${task.status === 'completed' ? 'Completed' : 'Mark Complete'}
              </button>
              <button class="delete-btn" onclick="deleteChannel('${task.id}')" title="Delete">
                🗑️
              </button>
            </div>
          </td>
        </tr>
      `).join('');

      // Add drag event listeners
      document.querySelectorAll('.draggable-row').forEach(row => {
        row.addEventListener('dragstart', handleDragStart);
        row.addEventListener('dragover', handleDragOver);
        row.addEventListener('drop', handleDrop);
        row.addEventListener('dragend', handleDragEnd);
      });
    }

    // Drag and Drop
    function handleDragStart(e) {
      draggedElement = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
    }

    function handleDrop(e) {
      e.preventDefault();
      if (draggedElement !== this) {
        const tbody = this.parentNode;
        const targetRect = this.getBoundingClientRect();
        const targetMiddle = targetRect.top + targetRect.height / 2;
        
        if (e.clientY < targetMiddle) {
          tbody.insertBefore(draggedElement, this);
        } else {
          tbody.insertBefore(draggedElement, this.nextSibling);
        }
        
        saveChannelOrder();
      }
    }

    function handleDragEnd() {
      document.querySelectorAll('.draggable-row').forEach(row => {
        row.classList.remove('dragging');
      });
      draggedElement = null;
    }

    async function saveChannelOrder() {
      try {
        const rows = document.querySelectorAll('.draggable-row');
        const newOrder = Array.from(rows).map((row, index) => ({
          channel_id: row.getAttribute('data-channel-id'),
          order_position: index
        }));
        
        await supabase.from('channel_order').delete().gt('id', 0);
        if (newOrder.length > 0) {
          await supabase.from('channel_order').insert(newOrder);
        }
        
        channelOrder = newOrder;
      } catch (error) {
        console.error('Error saving channel order:', error);
      }
    }

    // Global Functions
    window.toggleForm = function() {
      const formBody = document.getElementById('formBody');
      const icon = document.getElementById('formToggleIcon');
      
      if (formBody.classList.contains('expanded')) {
        formBody.classList.remove('expanded');
        icon.textContent = '▼';
      } else {
        formBody.classList.add('expanded');
        icon.textContent = '▲';
        setTimeout(() => document.getElementById('channelId').focus(), 300);
      }
    };

    window.addChannel = async function() {
      const id = document.getElementById('channelId').value.trim();
      const channel = document.getElementById('channelName').value.trim();
      const client = document.getElementById('client').value.trim();
      const collaborator = document.getElementById('collaborator').value.trim();
      const monthlyVideos = +document.getElementById('monthlyVideos').value || 0;

      if (!id || !channel) {
        alert("Channel ID and Name are required.");
        return;
      }

      try {
        const { error } = await supabase
          .from('tasks')
          .insert([{
            id: id,
            channel: channel,
            client: client,
            collaborator: collaborator,
            daily_videos: monthlyVideos,
            status: 'pending',
            last_updated: new Date().toISOString(),
            created_at: new Date().toISOString()
          }]);

        if (error) throw error;

        tasks.push({
          id: id,
          channel: channel,
          client: client,
          collaborator: collaborator,
          daily_videos: monthlyVideos,
          status: 'pending'
        });

        // Clear form
        document.getElementById('channelId').value = '';
        document.getElementById('channelName').value = '';
        document.getElementById('client').value = '';
        document.getElementById('collaborator').value = '';
        document.getElementById('monthlyVideos').value = '';
        
        toggleForm();
        renderTasks();
        alert('✅ Channel added successfully!');
      } catch (error) {
