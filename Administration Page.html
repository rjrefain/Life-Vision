<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeVision Payment Dashboard - August 2025</title>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--dark-color);
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .company-title {
            color: var(--dark-color);
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
        }

        .month-indicator {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Financial Overview Cards */
        .financial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .financial-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
        }

        .financial-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .financial-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 15px;
            color: white;
        }

        .revenue-card .financial-icon {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
        }

        .expense-card .financial-icon {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
        }

        .profit-card .financial-icon {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .financial-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .financial-amount {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .financial-bdt {
            font-size: 1rem;
            color: #7f8c8d;
            font-weight: 500;
        }

        /* Section Styles */
        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
        }

        .add-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .add-btn:hover {
            background: white;
            color: var(--primary-color);
            transform: scale(1.05);
        }

        /* Table Styles */
        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e8ecf0;
            font-weight: 500;
        }

        tr:nth-child(even) {
            background-color: var(--light-color);
        }

        tr:hover {
            background-color: #e3f2fd;
        }

        .editable {
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            min-height: 20px;
        }

        .editable:hover {
            background: #e8ecf0;
        }

        .editable:focus {
            outline: none;
            background: white;
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .auto-calculated {
            background: var(--light-color);
            color: #7f8c8d;
            font-weight: 600;
            font-style: italic;
            cursor: not-allowed;
        }

        .delete-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        /* Status Indicator */
        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            color: white;
            z-index: 1001;
            display: none;
            transition: all 0.3s ease;
        }

        .status-success {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
        }

        .status-error {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
        }

        .status-loading {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        /* Modal Styles (for both delete and input) */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            color: white;
        }

        .modal-icon {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 20px;
            border: 3px solid white;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .modal-message {
            margin-bottom: 25px;
            opacity: 0.9;
            line-height: 1.5;
        }

        /* Input Form Styles */
        .input-form {
            text-align: left;
            margin: 20px 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: white;
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-input:focus {
            outline: none;
            border-color: white;
            background: rgba(255, 255, 255, 0.2);
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            box-sizing: border-box;
        }

        .form-select option {
            background: var(--primary-color);
            color: white;
        }

        .modal-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            gap: 10px;
        }

        .modal-checkbox input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .modal-checkbox label {
            font-size: 0.9rem;
            cursor: pointer;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 24px;
            border: 2px solid white;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .modal-confirm {
            background: white;
            color: var(--primary-color);
        }

        .modal-confirm:hover {
            background: transparent;
            color: white;
            transform: scale(1.05);
        }

        .modal-cancel {
            background: transparent;
            color: white;
        }

        .modal-cancel:hover {
            background: white;
            color: var(--primary-color);
            transform: scale(1.05);
        }

        .delete-confirm {
            background: white;
            color: var(--danger-color);
        }

        .delete-confirm:hover {
            background: var(--danger-color);
            color: white;
            transform: scale(1.05);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }

            .header-section {
                flex-direction: column;
                text-align: center;
            }

            .company-title {
                font-size: 2rem;
            }

            .financial-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                gap: 15px;
            }

            .add-btn {
                width: 100%;
            }

            table, thead, tbody, th, td, tr {
                display: block;
            }

            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }

            tr {
                background: white;
                border: 1px solid #e8ecf0;
                border-radius: 10px;
                margin-bottom: 15px;
                padding: 15px;
            }

            td {
                border: none;
                padding: 8px 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            td::before {
                content: attr(data-label);
                font-weight: bold;
                color: var(--primary-color);
                flex-shrink: 0;
                margin-right: 10px;
                min-width: 100px;
            }

            .delete-btn {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header-section">
            <h1 class="company-title">LifeVision Media</h1>
            <div class="month-indicator">August 2025 Payment Report</div>
        </div>

        <!-- Financial Overview -->
        <div class="financial-grid">
            <div class="financial-card revenue-card">
                <div class="financial-icon">💰</div>
                <div class="financial-label">Total Revenue</div>
                <div class="financial-amount" id="totalRevenue">$0.00</div>
                <div class="financial-bdt" id="totalRevenueBdt">৳0</div>
            </div>

            <div class="financial-card expense-card">
                <div class="financial-icon">📊</div>
                <div class="financial-label">Total Expenses</div>
                <div class="financial-amount" id="totalExpenses">$0.00</div>
                <div class="financial-bdt" id="totalExpensesBdt">৳0</div>
            </div>

            <div class="financial-card profit-card">
                <div class="financial-icon">💎</div>
                <div class="financial-label">Net Profit</div>
                <div class="financial-amount" id="netProfit">$0.00</div>
                <div class="financial-bdt" id="netProfitBdt">৳0</div>
            </div>
        </div>

        <!-- Projects Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">📋 Active Projects</h2>
                <button class="add-btn" onclick="showAddProjectModal()">+ Add Project</button>
            </div>
            <div class="table-wrapper">
                <table id="projectsTable">
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Client</th>
                            <th>Amount (USD)</th>
                            <th>Amount (BDT)</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Team Salary Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">👥 Team Salary</h2>
                <button class="add-btn" onclick="showAddTeamMemberModal()">+ Add Member</button>
            </div>
            <div class="table-wrapper">
                <table id="teamTable">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Role</th>
                            <th>Salary (USD)</th>
                            <th>Salary (BDT)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Scaling Costs Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">📊 Monthly Scaling Costs</h2>
                <button class="add-btn" onclick="showAddScalingCostModal()">+ Add Cost</button>
            </div>
            <div class="table-wrapper">
                <table id="scalingTable">
                    <thead>
                        <tr>
                            <th>Cost Item</th>
                            <th>Amount (USD)</th>
                            <th>Amount (BDT)</th>
                            <th>Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Shareholders Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">🤝 Company Shareholders</h2>
                <button class="add-btn" onclick="showAddShareholderModal()">+ Add Shareholder</button>
            </div>
            <div class="table-wrapper">
                <table id="shareholdersTable">
                    <thead>
                        <tr>
                            <th>Shareholder Name</th>
                            <th>Share Percentage (%)</th>
                            <th>Monthly Profit Share (USD)</th>
                            <th>Monthly Profit Share (BDT)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Status Indicator -->
    <div class="status-indicator" id="statusIndicator"></div>

    <!-- Delete Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-icon">⚠️</div>
            <h3 class="modal-title">Delete Confirmation</h3>
            <p class="modal-message">Are you sure you want to delete this item? This action cannot be undone.</p>
            
            <div class="modal-checkbox">
                <input type="checkbox" id="dontAskAgain">
                <label for="dontAskAgain">Don't ask me again for now</label>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-cancel" onclick="closeDeleteModal()">Cancel</button>
                <button class="modal-btn delete-confirm" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div class="modal" id="addProjectModal">
        <div class="modal-content">
            <div class="modal-icon">📋</div>
            <h3 class="modal-title">Add New Project</h3>
            
            <div class="input-form">
                <div class="form-group">
                    <label class="form-label">Project Name</label>
                    <input type="text" class="form-input" id="projectName" placeholder="Enter project name">
                </div>
                <div class="form-group">
                    <label class="form-label">Client Name</label>
                    <input type="text" class="form-input" id="projectClient" placeholder="Enter client name">
                </div>
                <div class="form-group">
                    <label class="form-label">Amount (USD)</label>
                    <input type="number" class="form-input" id="projectAmount" placeholder="Enter amount in USD" step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="projectStatus">
                        <option value="Pending">Pending</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Complete">Complete</option>
                        <option value="On Hold">On Hold</option>
                    </select>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-cancel" onclick="closeAddProjectModal()">Cancel</button>
                <button class="modal-btn modal-confirm" onclick="addProject()">Add Project</button>
            </div>
        </div>
    </div>

    <!-- Add Team Member Modal -->
    <div class="modal" id="addTeamMemberModal">
        <div class="modal-content">
            <div class="modal-icon">👥</div>
            <h3 class="modal-title">Add New Team Member</h3>
            
            <div class="input-form">
                <div class="form-group">
                    <label class="form-label">Member Name</label>
                    <input type="text" class="form-input" id="memberName" placeholder="Enter member name">
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <input type="text" class="form-input" id="memberRole" placeholder="Enter role">
                </div>
                <div class="form-group">
                    <label class="form-label">Salary (USD)</label>
                    <input type="number" class="form-input" id="memberSalary" placeholder="Enter salary in USD" step="0.01">
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-cancel" onclick="closeAddTeamMemberModal()">Cancel</button>
                <button class="modal-btn modal-confirm" onclick="addTeamMember()">Add Member</button>
            </div>
        </div>
    </div>

    <!-- Add Scaling Cost Modal -->
    <div class="modal" id="addScalingCostModal">
        <div class="modal-content">
            <div class="modal-icon">📊</div>
            <h3 class="modal-title">Add New Scaling Cost</h3>
            
            <div class="input-form">
                <div class="form-group">
                    <label class="form-label">Cost Item Name</label>
                    <input type="text" class="form-input" id="costItemName" placeholder="Enter cost item name">
                </div>
                <div class="form-group">
                    <label class="form-label">Amount (USD)</label>
                    <input type="number" class="form-input" id="costAmount" placeholder="Enter amount in USD" step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">Cost Type</label>
                    <select class="form-select" id="costType">
                        <option value="Monthly">Monthly</option>
                        <option value="One-time">One-time</option>
                        <option value="Quarterly">Quarterly</option>
                        <option value="Annual">Annual</option>
                    </select>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-cancel" onclick="closeAddScalingCostModal()">Cancel</button>
                <button class="modal-btn modal-confirm" onclick="addScalingCost()">Add Cost</button>
            </div>
        </div>
    </div>

    <!-- Add Shareholder Modal -->
    <div class="modal" id="addShareholderModal">
        <div class="modal-content">
            <div class="modal-icon">🤝</div>
            <h3 class="modal-title">Add New Shareholder</h3>
            
            <div class="input-form">
                <div class="form-group">
                    <label class="form-label">Shareholder Name</label>
                    <input type="text" class="form-input" id="shareholderName" placeholder="Enter shareholder name">
                </div>
                <div class="form-group">
                    <label class="form-label">Share Percentage (%)</label>
                    <input type="number" class="form-input" id="shareholderPercentage" placeholder="Enter percentage" min="0" max="100" step="0.1">
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-cancel" onclick="closeAddShareholderModal()">Cancel</button>
                <button class="modal-btn modal-confirm" onclick="addShareholder()">Add Shareholder</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2'

        // Supabase configuration
        const supabaseUrl = 'https://prkrbswtmtgeplsvzlj.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBya3Jic3d0dG10Z2VwbHN2emxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNTk5NjQsImV4cCI6MjA3MjYzNTk2NH0.Ul2cd-cpWHfpK1HTgHM7Tv2NDCrFWcAq2N-C7Tv9oz8'
        const supabase = createClient(supabaseUrl, supabaseKey)

        // Global variables
        let exchangeRate = 100;
        let skipDeleteConfirmation = false;
        let pendingDeleteData = null;

        // Data arrays
        let projectsData = [
            { id: 1, name: "Jaroslav Project 1", client: "Refain", amount_usd: 640, status: "Complete" },
            { id: 2, name: "Jaroslav Project 2", client: "Eity", amount_usd: 660, status: "Complete" },
            { id: 3, name: "Jaroslav Project 3", client: "Reon", amount_usd: 350, status: "Complete" },
            { id: 4, name: "Jason Hill Project 1", client: "Jason Hill", amount_usd: 500, status: "Complete" }
        ];

        let teamData = [
            { id: 1, rank: 1, name: "Razu", role: "Senior Producer", salary_usd: 250 },
            { id: 2, rank: 2, name: "Robin", role: "Content Creator", salary_usd: 180 },
            { id: 3, rank: 3, name: "Mehedi", role: "Video Editor", salary_usd: 160 },
            { id: 4, rank: 4, name: "Emran", role: "Producer", salary_usd: 136 },
            { id: 5, rank: 5, name: "Sakil", role: "Assistant Editor", salary_usd: 120.50 }
        ];

        let scalingData = [
            { id: 1, item_name: "PC Service", amount_usd: 80, cost_type: "Monthly" },
            { id: 2, item_name: "WiFi Bill", amount_usd: 20, cost_type: "Monthly" },
            { id: 3, item_name: "Electricity Bill", amount_usd: 20, cost_type: "Monthly" },
            { id: 4, item_name: "Basa Vara (Rent)", amount_usd: 30, cost_type: "Monthly" },
            { id: 5, item_name: "Laptop", amount_usd: 3, cost_type: "Monthly" }
        ];

        let shareholdersData = [
            { id: 1, name: "Refain", percentage: 70 },
            { id: 2, name: "Reon", percentage: 30 }
        ];

        // Status indicator
        function showStatus(message, type = 'success') {
            const indicator = document.getElementById('statusIndicator');
            indicator.textContent = message;
            indicator.className = `status-indicator status-${type}`;
            indicator.style.display = 'block';
            
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 3000);
        }

        // Calculate and update financials
        function calculateFinancials() {
            const totalRevenue = projectsData.reduce((sum, project) => sum + project.amount_usd, 0);
            const teamExpenses = teamData.reduce((sum, member) => sum + member.salary_usd, 0);
            const scalingExpenses = scalingData.reduce((sum, cost) => sum + cost.amount_usd, 0);
            const totalExpenses = teamExpenses + scalingExpenses;
            const netProfit = totalRevenue - totalExpenses;

            document.getElementById('totalRevenue').textContent = `${totalRevenue.toFixed(2)}`;
            document.getElementById('totalRevenueBdt').textContent = `৳${(totalRevenue * exchangeRate).toLocaleString()}`;
            
            document.getElementById('totalExpenses').textContent = `${totalExpenses.toFixed(2)}`;
            document.getElementById('totalExpensesBdt').textContent = `৳${(totalExpenses * exchangeRate).toLocaleString()}`;
            
            document.getElementById('netProfit').textContent = `${netProfit.toFixed(2)}`;
            document.getElementById('netProfitBdt').textContent = `৳${(netProfit * exchangeRate).toLocaleString()}`;

            updateShareholdersTable();
        }

        // Update projects table
        function updateProjectsTable() {
            const tbody = document.querySelector('#projectsTable tbody');
            tbody.innerHTML = '';

            projectsData.forEach(project => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td data-label="Project Name" class="editable" contenteditable="true" data-field="name">${project.name}</td>
                    <td data-label="Client" class="editable" contenteditable="true" data-field="client">${project.client}</td>
                    <td data-label="Amount (USD)" class="editable" contenteditable="true" data-field="amount_usd">${project.amount_usd.toFixed(2)}</td>
                    <td data-label="Amount (BDT)" class="auto-calculated">৳${(project.amount_usd * exchangeRate).toLocaleString()}</td>
                    <td data-label="Status" class="editable" contenteditable="true" data-field="status">${project.status}</td>
                    <td data-label="Actions"><button class="delete-btn" onclick="deleteItem('projects', ${project.id})">Delete</button></td>
                `;
                row.dataset.id = project.id;
            });
        }

        // Update team table
        function updateTeamTable() {
            const tbody = document.querySelector('#teamTable tbody');
            tbody.innerHTML = '';

            teamData.forEach((member, index) => {
                const row = tbody.insertRow();
                const rankDisplay = index === 0 ? '🥇 1' : index === 1 ? '🥈 2' : index === 2 ? '🥉 3' : `${index + 1}`;
                
                row.innerHTML = `
                    <td data-label="Rank">${rankDisplay}</td>
                    <td data-label="Name" class="editable" contenteditable="true" data-field="name">${member.name}</td>
                    <td data-label="Role" class="editable" contenteditable="true" data-field="role">${member.role}</td>
                    <td data-label="Salary (USD)" class="editable" contenteditable="true" data-field="salary_usd">${member.salary_usd.toFixed(2)}</td>
                    <td data-label="Salary (BDT)" class="auto-calculated">৳${(member.salary_usd * exchangeRate).toLocaleString()}</td>
                    <td data-label="Actions"><button class="delete-btn" onclick="deleteItem('team', ${member.id})">Delete</button></td>
                `;
                row.dataset.id = member.id;
            });
        }

        // Update scaling table
        function updateScalingTable() {
            const tbody = document.querySelector('#scalingTable tbody');
            tbody.innerHTML = '';

            scalingData.forEach(cost => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td data-label="Cost Item" class="editable" contenteditable="true" data-field="item_name">${cost.item_name}</td>
                    <td data-label="Amount (USD)" class="editable" contenteditable="true" data-field="amount_usd">${cost.amount_usd.toFixed(2)}</td>
                    <td data-label="Amount (BDT)" class="auto-calculated">৳${(cost.amount_usd * exchangeRate).toLocaleString()}</td>
                    <td data-label="Type" class="editable" contenteditable="true" data-field="cost_type">${cost.cost_type}</td>
                    <td data-label="Actions"><button class="delete-btn" onclick="deleteItem('scaling', ${cost.id})">Delete</button></td>
                `;
                row.dataset.id = cost.id;
            });
        }

        // Update shareholders table
        function updateShareholdersTable() {
            const tbody = document.querySelector('#shareholdersTable tbody');
            tbody.innerHTML = '';

            const totalRevenue = projectsData.reduce((sum, p) => sum + p.amount_usd, 0);
            const totalExpenses = teamData.reduce((sum, t) => sum + t.salary_usd, 0) + 
                                scalingData.reduce((sum, s) => sum + s.amount_usd, 0);
            const netProfit = totalRevenue - totalExpenses;

            shareholdersData.forEach(shareholder => {
                const row = tbody.insertRow();
                const profitShare = (netProfit * shareholder.percentage) / 100;
                
                row.innerHTML = `
                    <td data-label="Shareholder Name" class="editable" contenteditable="true" data-field="name">${shareholder.name}</td>
                    <td data-label="Share Percentage" class="editable" contenteditable="true" data-field="percentage">${shareholder.percentage}%</td>
                    <td data-label="Profit Share (USD)" class="auto-calculated">${profitShare.toFixed(2)}</td>
                    <td data-label="Profit Share (BDT)" class="auto-calculated">৳${(profitShare * exchangeRate).toLocaleString()}</td>
                    <td data-label="Actions"><button class="delete-btn" onclick="deleteItem('shareholders', ${shareholder.id})">Delete</button></td>
                `;
                row.dataset.id = shareholder.id;
            });
        }

        // Update all tables
        function updateAllTables() {
            updateProjectsTable();
            updateTeamTable();
            updateScalingTable();
            updateShareholdersTable();
        }

        // Handle cell editing
        function setupCellEditing() {
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('editable')) {
                    const cell = e.target;
                    const row = cell.closest('tr');
                    const table = cell.closest('table');
                    const field = cell.dataset.field;
                    const id = parseInt(row.dataset.id);
                    
                    let dataArray;
                    if (table.id === 'projectsTable') {
                        dataArray = projectsData;
                    } else if (table.id === 'teamTable') {
                        dataArray = teamData;
                    } else if (table.id === 'scalingTable') {
                        dataArray = scalingData;
                    } else if (table.id === 'shareholdersTable') {
                        dataArray = shareholdersData;
                    }

                    const item = dataArray.find(item => item.id === id);
                    if (item && field) {
                        let value = cell.textContent.trim();
                        
                        if (field.includes('usd') || field === 'amount_usd' || field === 'salary_usd') {
                            value = parseFloat(value.replace(', '').replace(',', '')) || 0;
                        } else if (field === 'percentage') {
                            value = parseInt(value.replace('%', '')) || 0;
                        }
                        
                        item[field] = value;
                        
                        calculateFinancials();
                        updateAllTables();
                        
                        clearTimeout(window.autoSaveTimer);
                        window.autoSaveTimer = setTimeout(() => {
                            saveData();
                        }, 2000);
                    }
                }
            });
        }

        // Modal functions for adding items
        window.showAddProjectModal = function() {
            document.getElementById('addProjectModal').classList.add('show');
            document.getElementById('projectName').value = '';
            document.getElementById('projectClient').value = '';
            document.getElementById('projectAmount').value = '';
            document.getElementById('projectStatus').value = 'Pending';
        };

        window.closeAddProjectModal = function() {
            document.getElementById('addProjectModal').classList.remove('show');
        };

        window.addProject = function() {
            const name = document.getElementById('projectName').value.trim();
            const client = document.getElementById('projectClient').value.trim();
            const amount = parseFloat(document.getElementById('projectAmount').value) || 0;
            const status = document.getElementById('projectStatus').value;

            if (!name || !client) {
                showStatus('Please fill in all required fields', 'error');
                return;
            }

            const newId = Date.now();
            const newProject = {
                id: newId,
                name: name,
                client: client,
                amount_usd: amount,
                status: status
            };
            
            projectsData.push(newProject);
            updateProjectsTable();
            calculateFinancials();
            closeAddProjectModal();
            showStatus('New project added successfully!');
            saveData();
        };

        window.showAddTeamMemberModal = function() {
            document.getElementById('addTeamMemberModal').classList.add('show');
            document.getElementById('memberName').value = '';
            document.getElementById('memberRole').value = '';
            document.getElementById('memberSalary').value = '';
        };

        window.closeAddTeamMemberModal = function() {
            document.getElementById('addTeamMemberModal').classList.remove('show');
        };

        window.addTeamMember = function() {
            const name = document.getElementById('memberName').value.trim();
            const role = document.getElementById('memberRole').value.trim();
            const salary = parseFloat(document.getElementById('memberSalary').value) || 0;

            if (!name || !role) {
                showStatus('Please fill in all required fields', 'error');
                return;
            }

            const newId = Date.now();
            const newMember = {
                id: newId,
                rank: teamData.length + 1,
                name: name,
                role: role,
                salary_usd: salary
            };
            
            teamData.push(newMember);
            updateTeamTable();
            calculateFinancials();
            closeAddTeamMemberModal();
            showStatus('New team member added successfully!');
            saveData();
        };

        window.showAddScalingCostModal = function() {
            document.getElementById('addScalingCostModal').classList.add('show');
            document.getElementById('costItemName').value = '';
            document.getElementById('costAmount').value = '';
            document.getElementById('costType').value = 'Monthly';
        };

        window.closeAddScalingCostModal = function() {
            document.getElementById('addScalingCostModal').classList.remove('show');
        };

        window.addScalingCost = function() {
            const itemName = document.getElementById('costItemName').value.trim();
            const amount = parseFloat(document.getElementById('costAmount').value) || 0;
            const costType = document.getElementById('costType').value;

            if (!itemName) {
                showStatus('Please fill in all required fields', 'error');
                return;
            }

            const newId = Date.now();
            const newCost = {
                id: newId,
                item_name: itemName,
                amount_usd: amount,
                cost_type: costType
            };
            
            scalingData.push(newCost);
            updateScalingTable();
            calculateFinancials();
            closeAddScalingCostModal();
            showStatus('New cost item added successfully!');
            saveData();
        };

        window.showAddShareholderModal = function() {
            document.getElementById('addShareholderModal').classList.add('show');
            document.getElementById('shareholderName').value = '';
            document.getElementById('shareholderPercentage').value = '';
        };

        window.closeAddShareholderModal = function() {
            document.getElementById('addShareholderModal').classList.remove('show');
        };

        window.addShareholder = function() {
            const name = document.getElementById('shareholderName').value.trim();
            const percentage = parseFloat(document.getElementById('shareholderPercentage').value) || 0;

            if (!name || percentage <= 0 || percentage > 100) {
                showStatus('Please enter valid shareholder details', 'error');
                return;
            }

            const newId = Date.now();
            const newShareholder = {
                id: newId,
                name: name,
                percentage: percentage
            };
            
            shareholdersData.push(newShareholder);
            updateShareholdersTable();
            calculateFinancials();
            closeAddShareholderModal();
            showStatus('New shareholder added successfully!');
            saveData();
        };

        // Delete modal functions
        window.deleteItem = function(type, id) {
            if (skipDeleteConfirmation) {
                performDelete(type, id);
                return;
            }

            pendingDeleteData = { type, id };
            document.getElementById('deleteModal').classList.add('show');
        };

        window.closeDeleteModal = function() {
            document.getElementById('deleteModal').classList.remove('show');
            pendingDeleteData = null;
            document.getElementById('dontAskAgain').checked = false;
        };

        window.confirmDelete = function() {
            if (pendingDeleteData) {
                const dontAskAgain = document.getElementById('dontAskAgain').checked;
                if (dontAskAgain) {
                    skipDeleteConfirmation = true;
                    setTimeout(() => {
                        skipDeleteConfirmation = false;
                    }, 300000); // Reset after 5 minutes
                }

                performDelete(pendingDeleteData.type, pendingDeleteData.id);
            }
            closeDeleteModal();
        };

        function performDelete(type, id) {
            if (type === 'projects') {
                projectsData = projectsData.filter(item => item.id !== id);
                updateProjectsTable();
            } else if (type === 'team') {
                teamData = teamData.filter(item => item.id !== id);
                updateTeamTable();
            } else if (type === 'scaling') {
                scalingData = scalingData.filter(item => item.id !== id);
                updateScalingTable();
            } else if (type === 'shareholders') {
                shareholdersData = shareholdersData.filter(item => item.id !== id);
                updateShareholdersTable();
            }

            calculateFinancials();
            showStatus('Item deleted successfully!');
            saveData();
        }

        // Save data to Supabase
        async function saveData() {
            try {
                showStatus('Saving data...', 'loading');

                // Save to Supabase (you can implement the actual saving logic here)
                // For now, we'll just show a success message
                
                showStatus('Data saved successfully!');
                return true;
            } catch (error) {
                console.error('Error saving data:', error);
                showStatus('Failed to save data', 'error');
                return false;
            }
        }

        // Load data from Supabase
        async function loadData() {
            try {
                showStatus('Loading data...', 'loading');

                // Load from Supabase (you can implement the actual loading logic here)
                // For now, we'll use the default data
                
                updateAllTables();
                calculateFinancials();
                showStatus('Data loaded successfully!');
            } catch (error) {
                console.error('Error loading data:', error);
                showStatus('Failed to load data', 'error');
                updateAllTables();
                calculateFinancials();
            }
        }

        // Initialize application
        function initialize() {
            setupCellEditing();
            loadData();
        }

        // Start the application when DOM loads
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
