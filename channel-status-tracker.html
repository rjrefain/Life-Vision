<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Channel Status & Topic Tracker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #667eea;
      --secondary: #764ba2;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --gray-100: #f8f9fa;
      --gray-200: #e9ecef;
      --gray-600: #6c757d;
      --gray-800: #343a40;
      --gray-900: #212529;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      min-height: 100vh;
      color: var(--gray-900);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    h1 {
      color: var(--gray-900);
      font-size: 2.2em;
      font-weight: 600;
      margin: 0;
    }

    .nav-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .nav-btn {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      text-decoration: none;
      padding: 12px 20px;
      border-radius: 25px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .stat-label {
      color: var(--gray-600);
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .green-stat { color: var(--success); }
    .yellow-stat { color: var(--warning); }
    .red-stat { color: var(--danger); }
    .topic-stat { color: var(--primary); }

    .sync-status {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 15px 20px;
      margin-bottom: 25px;
      text-align: center;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9em;
    }

    .status-connected {
      background: #d1fae5;
      color: #065f46;
    }

    .status-loading {
      background: #fef3c7;
      color: #92400e;
    }

    .status-error {
      background: #fee2e2;
      color: #991b1b;
    }

    .channels-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      min-height: 400px;
    }

    .channels-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 20px 25px;
      font-size: 1.3em;
      font-weight: 600;
      text-align: center;
    }

    .channel-item {
      padding: 20px 25px;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.3s ease;
      position: relative;
      background: white;
    }

    /* Color background overlays */
    .channel-item.condition-green {
      background: linear-gradient(135deg, rgba(39, 174, 96, 0.08), rgba(46, 204, 113, 0.05));
      border-left: 4px solid var(--success);
    }

    .channel-item.condition-yellow {
      background: linear-gradient(135deg, rgba(243, 156, 18, 0.08), rgba(245, 171, 53, 0.05));
      border-left: 4px solid var(--warning);
    }

    .channel-item.condition-red {
      background: linear-gradient(135deg, rgba(231, 76, 60, 0.08), rgba(192, 57, 43, 0.05));
      border-left: 4px solid var(--danger);
    }

    .channel-item:hover {
      transform: translateX(3px);
    }

    .channel-item.condition-green:hover {
      background: linear-gradient(135deg, rgba(39, 174, 96, 0.12), rgba(46, 204, 113, 0.08));
      box-shadow: 0 5px 20px rgba(39, 174, 96, 0.2);
    }

    .channel-item.condition-yellow:hover {
      background: linear-gradient(135deg, rgba(243, 156, 18, 0.12), rgba(245, 171, 53, 0.08));
      box-shadow: 0 5px 20px rgba(243, 156, 18, 0.2);
    }

    .channel-item.condition-red:hover {
      background: linear-gradient(135deg, rgba(231, 76, 60, 0.12), rgba(192, 57, 43, 0.08));
      box-shadow: 0 5px 20px rgba(231, 76, 60, 0.2);
    }

    .channel-item:last-child {
      border-bottom: none;
    }

    /* Floating animation for color changes */
    .channel-item.floating {
      z-index: 1000;
      background: white;
      border-radius: 15px;
      border: 3px solid var(--primary);
      box-shadow: 0 25px 80px rgba(102, 126, 234, 0.4);
      animation: spectacularFloat 2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    }

    @keyframes spectacularFloat {
      0% {
        transform: translateY(0) scale(1);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
      }
      25% {
        transform: translateY(-20px) scale(1.03);
        box-shadow: 0 35px 60px rgba(102, 126, 234, 0.4);
      }
      50% {
        transform: translateY(-40px) scale(1.05);
        box-shadow: 0 50px 100px rgba(102, 126, 234, 0.5);
      }
      75% {
        transform: translateY(-30px) scale(1.03);
        box-shadow: 0 40px 80px rgba(102, 126, 234, 0.4);
      }
      100% {
        transform: translateY(0) scale(1);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        border: none;
        border-radius: 0;
      }
    }

    .channel-info {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr auto;
      gap: 20px;
      align-items: center;
    }

    .channel-name {
      font-weight: 600;
      font-size: 1.1em;
      color: var(--gray-900);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .channel-client {
      color: var(--gray-600);
      font-size: 0.95em;
    }

    .channel-collaborator {
      color: var(--gray-600);
      font-size: 0.95em;
      font-style: italic;
    }

    .channel-controls {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    /* Visit checkbox styles */
    .visit-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85em;
      font-weight: 500;
      padding: 6px 10px;
      border-radius: 8px;
      transition: all 0.3s ease;
      min-width: 140px;
    }

    .visit-checkbox.visited {
      background: rgba(39, 174, 96, 0.1);
      color: var(--success);
    }

    .visit-checkbox.warning {
      background: rgba(231, 76, 60, 0.1);
      color: var(--danger);
      animation: warningPulse 2s infinite;
    }

    @keyframes warningPulse {
      0%, 100% { background: rgba(231, 76, 60, 0.1); }
      50% { background: rgba(231, 76, 60, 0.2); }
    }

    .visit-check {
      width: 18px;
      height: 18px;
      border: 2px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    .visit-check.checked {
      background: var(--success);
      border-color: var(--success);
      color: white;
    }

    .visit-check:hover {
      border-color: var(--primary);
    }

    .warning-badge {
      background: var(--danger);
      color: white;
      padding: 2px 6px;
      border-radius: 8px;
      font-size: 0.7em;
      font-weight: bold;
      animation: warningBlink 1.5s infinite;
    }

    @keyframes warningBlink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0.6; }
    }

    .topic-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85em;
      font-weight: 500;
    }

    .toggle-switch {
      position: relative;
      width: 45px;
      height: 22px;
      background: #ccc;
      border-radius: 25px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .toggle-switch.active {
      background: var(--success);
    }

    .toggle-slider {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .toggle-switch.active .toggle-slider {
      transform: translateX(23px);
    }

    .condition-selector {
      display: flex;
      gap: 5px;
    }

    .condition-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 3px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .condition-btn.green {
      background: var(--success);
    }

    .condition-btn.yellow {
      background: var(--warning);
    }

    .condition-btn.red {
      background: var(--danger);
    }

    .condition-btn.active {
      border-color: var(--gray-900);
      transform: scale(1.2);
      box-shadow: 0 0 0 2px white, 0 0 15px rgba(0,0,0,0.3);
    }

    .condition-btn:hover:not(.active) {
      transform: scale(1.1);
    }

    .priority-badge {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 5px;
      border-radius: 0 10px 10px 0;
    }

    .priority-green {
      background: var(--success);
      box-shadow: 0 0 10px rgba(39, 174, 96, 0.3);
    }

    .priority-yellow {
      background: var(--warning);
      box-shadow: 0 0 10px rgba(243, 156, 18, 0.3);
    }

    .priority-red {
      background: var(--danger);
      box-shadow: 0 0 10px rgba(231, 76, 60, 0.3);
    }

    .loading-state, .empty-state {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 60px 20px;
      color: var(--gray-600);
      font-size: 1.1em;
      text-align: center;
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: center;
      }

      h1 {
        font-size: 1.8em;
        text-align: center;
      }

      .nav-buttons {
        justify-content: center;
      }

      .channel-info {
        grid-template-columns: 1fr;
        gap: 10px;
        text-align: left;
      }

      .channel-controls {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
      }

      .condition-selector {
        justify-content: center;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìä Channel Status & Topic Tracker</h1>
      <div class="nav-buttons">
        <a href="index.html" class="nav-btn">üè† Main Tracker</a>
        <a href="Administration Page.html" class="nav-btn">üîê Admin</a>
        <a href="task-dashboard.html" class="nav-btn">üìã Tasks</a>
        <a href="payment_tracker.html" class="nav-btn">üí∞ Payment</a>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number green-stat" id="greenCount">0</div>
        <div class="stat-label">Green Channels</div>
      </div>
      <div class="stat-card">
        <div class="stat-number yellow-stat" id="yellowCount">0</div>
        <div class="stat-label">Yellow Channels</div>
      </div>
      <div class="stat-card">
        <div class="stat-number red-stat" id="redCount">0</div>
        <div class="stat-label">Red Channels</div>
      </div>
      <div class="stat-card">
        <div class="stat-number topic-stat" id="topicAvailableCount">0</div>
        <div class="stat-label">Topics Available</div>
      </div>
      <div class="stat-card">
        <div class="stat-number red-stat" id="needVisitCount">0</div>
        <div class="stat-label">Need Visit</div>
      </div>
    </div>

    <div class="sync-status">
      <div class="status-indicator status-loading" id="syncStatus">
        <span>üîÑ</span> Loading channels...
      </div>
    </div>

    <div class="channels-container">
      <div class="channels-header">
        üì∫ Active Channels (Auto-sorted by Condition)
      </div>
      <div id="channelsBody">
        <div class="loading-state">
          <span style="margin-right: 10px;">üîÑ</span>
          Loading channel data...
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2'

    // Supabase configuration
    const supabaseUrl = 'https://prkrbswttmtgeplsvzlj.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBya3Jic3d0dG10Z2VwbHN2emxqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNTk5NjQsImV4cCI6MjA3MjYzNTk2NH0.Ul2cd-cpWHfpK1HTgHM7Tv2NDCrFWcAq2N-C7Tv9oz8'
    const supabase = createClient(supabaseUrl, supabaseKey)

    let channels = [];
    let isConnected = false;

    // Connection monitoring
    async function checkConnection() {
      try {
        const { data, error } = await supabase.from('tasks').select('count', { count: 'exact', head: true });
        isConnected = !error;
        updateSyncStatus();
      } catch (error) {
        isConnected = false;
        updateSyncStatus();
      }
    }

    function updateSyncStatus() {
      const syncStatus = document.getElementById('syncStatus');
      if (isConnected) {
        syncStatus.innerHTML = '<span>‚úÖ</span> Connected to Database';
        syncStatus.className = 'status-indicator status-connected';
      } else {
        syncStatus.innerHTML = '<span>‚ùå</span> Connection Lost';
        syncStatus.className = 'status-indicator status-error';
      }
    }

    // Load channels data
    async function loadChannels() {
      try {
        // Load tasks first
        const { data: tasksData, error: tasksError } = await supabase
          .from('tasks')
          .select('*');
        
        if (tasksError) throw tasksError;
        
        if (!tasksData || tasksData.length === 0) {
          channels = [];
          renderChannels();
          updateStats();
          return;
        }
        
        // Load status data
        const { data: statusData, error: statusError } = await supabase
          .from('channel_status')
          .select('*');
        
        if (statusError) {
          console.error('Error loading channel status:', statusError);
          // Continue without status data
        }
        
        const statusMap = {};
        if (statusData) {
          statusData.forEach(status => {
            statusMap[status.channel_id] = status;
          });
        }
        
        // Combine data
        channels = tasksData.map(task => ({
          ...task,
          condition: statusMap[task.id]?.condition || 'yellow',
          topic_available: statusMap[task.id]?.topic_available || false,
          last_visited: statusMap[task.id]?.last_visited || false,
          visited_at: statusMap[task.id]?.visited_at || null
        }));

        updateVisitWarnings();
        renderChannels();
        updateStats();
        
        isConnected = true;
        updateSyncStatus();
      } catch (error) {
        console.error('Error loading channels:', error);
        isConnected = false;
        updateSyncStatus();
        document.getElementById('channelsBody').innerHTML = `
          <div class="empty-state">
            <h3>Error Loading Channels</h3>
            <p>Please check your connection and try again.</p>
          </div>
        `;
      }
    }

    // Check and update visit warnings
    function updateVisitWarnings() {
      const now = new Date().getTime();
      const FORTY_EIGHT_HOURS = 48 * 60 * 60 * 1000;

      channels.forEach(async (channel) => {
        if (channel.visited_at && channel.last_visited) {
          const visitTime = new Date(channel.visited_at).getTime();
          const timeDiff = now - visitTime;
          
          if (timeDiff > FORTY_EIGHT_HOURS) {
            // Auto-reset expired visits
            try {
              await supabase
                .from('channel_status')
                .upsert({
                  channel_id: channel.id,
                  last_visited: false,
                  visited_at: null
                });
              
              // Update local data
              channel.last_visited = false;
              channel.visited_at = null;
            } catch (error) {
              console.error('Error resetting visit status:', error);
            }
          }
        }
      });
    }

    function getVisitStatus(channel) {
      if (!channel.visited_at || !channel.last_visited) {
        return { status: 'warning', message: 'Need visit' };
      }

      const now = new Date().getTime();
      const visitTime = new Date(channel.visited_at).getTime();
      const timeDiff = now - visitTime;
      const FORTY_EIGHT_HOURS = 48 * 60 * 60 * 1000;

      if (timeDiff > FORTY_EIGHT_HOURS) {
        return { status: 'warning', message: 'Need visit' };
      } else {
        const hoursLeft = Math.ceil((FORTY_EIGHT_HOURS - timeDiff) / (60 * 60 * 1000));
        return { status: 'visited', message: `${hoursLeft}h left` };
      }
    }

    // Sort channels
    function sortChannels(channelsList) {
      const priorityOrder = { 'green': 0, 'yellow': 1, 'red': 2 };
      return channelsList.sort((a, b) => {
        const priorityDiff = priorityOrder[a.condition] - priorityOrder[b.condition];
        if (priorityDiff !== 0) return priorityDiff;
        
        const aTime = new Date(a.last_updated || 0).getTime();
        const bTime = new Date(b.last_updated || 0).getTime();
        return aTime - bTime;
      });
    }

    function renderChannels() {
      const channelsBody = document.getElementById('channelsBody');
      
      if (channels.length === 0) {
        channelsBody.innerHTML = `
          <div class="empty-state">
            <h3>No Active Channels</h3>
            <p>Add channels in the main tracker to see them here.</p>
          </div>
        `;
        return;
      }

      const sortedChannels = sortChannels([...channels]);
      
      channelsBody.innerHTML = sortedChannels.map(channel => {
        const visitStatus = getVisitStatus(channel);
        
        return `
          <div class="channel-item condition-${channel.condition}" data-id="${channel.id}">
            <div class="priority-badge priority-${channel.condition}"></div>
            <div class="channel-info">
              <div>
                <div class="channel-name">
                  ${channel.channel}
                  ${visitStatus.status === 'warning' ? '<span class="warning-badge">‚ö†Ô∏è VISIT</span>' : ''}
                </div>
                <div class="channel-client">Client: ${channel.client || 'Not specified'}</div>
              </div>
              <div class="channel-collaborator">
                üë§ ${channel.collaborator || 'Unassigned'}
              </div>
              <div style="color: var(--gray-600); font-size: 0.9em;">
                üìπ ${channel.daily_videos || 0} videos/day
              </div>
              <div class="channel-controls">
                <div class="visit-checkbox ${visitStatus.status}">
                  <div class="visit-check ${channel.last_visited ? 'checked' : ''}" 
                       onclick="toggleVisit('${channel.id}')"
                       title="Mark as visited for 48 hours">
                    ${channel.last_visited ? '‚úì' : ''}
                  </div>
                  <span>${visitStatus.message}</span>
                </div>
                <div class="topic-toggle">
                  <span>Topic:</span>
                  <div class="toggle-switch ${channel.topic_available ? 'active' : ''}" onclick="toggleTopic('${channel.id}')">
                    <div class="toggle-slider"></div>
                  </div>
                  <span style="font-weight: 600; color: ${channel.topic_available ? 'var(--success)' : 'var(--danger)'}; font-size: 0.8em;">
                    ${channel.topic_available ? 'YES' : 'NO'}
                  </span>
                </div>
                <div class="condition-selector">
                  <div class="condition-btn green ${channel.condition === 'green' ? 'active' : ''}" 
                       onclick="setCondition('${channel.id}', 'green')" title="Green - All Good"></div>
                  <div class="condition-btn yellow ${channel.condition === 'yellow' ? 'active' : ''}" 
                       onclick="setCondition('${channel.id}', 'yellow')" title="Yellow - Attention Needed"></div>
                  <div class="condition-btn red ${channel.condition === 'red' ? 'active' : ''}" 
                       onclick="setCondition('${channel.id}', 'red')" title="Red - Issues"></div>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Global functions
    window.toggleVisit = async function(channelId) {
      if (!isConnected) {
        alert('No database connection. Please check your internet.');
        return;
      }

      const channel = channels.find(c => c.id === channelId);
      if (channel) {
        const newVisitStatus = !channel.last_visited;
        const visitedAt = newVisitStatus ? new Date().toISOString() : null;
        
        try {
          await supabase
            .from('channel_status')
            .upsert({
              channel_id: channelId,
              last_visited: newVisitStatus,
              visited_at: visitedAt
            });
          
          // Update local data
          channel.last_visited = newVisitStatus;
          channel.visited_at = visitedAt;
          renderChannels();
          updateStats();
        } catch (error) {
          console.error('Error updating visit status:', error);
          alert('Failed to update visit status. Please try again.');
        }
      }
    };

    window.toggleTopic = async function(channelId) {
      if (!isConnected) {
        alert('No database connection. Please check your internet.');
        return;
      }

      const channel = channels.find(c => c.id === channelId);
      if (channel) {
        try {
          const newTopicStatus = !channel.topic_available;
          
          await supabase
            .from('channel_status')
            .upsert({
              channel_id: channelId,
              topic_available: newTopicStatus
            });
          
          // Update local data
          channel.topic_available = newTopicStatus;
          renderChannels();
          updateStats();
        } catch (error) {
          console.error('Error updating topic status:', error);
          alert('Failed to update topic status. Please try again.');
        }
      }
    };

    window.setCondition = async function(channelId, condition) {
      if (!isConnected) {
        alert('No database connection. Please check your internet.');
        return;
      }

      const channelElement = document.querySelector(`[data-id="${channelId}"]`);
      
      if (channelElement) {
        channelElement.classList.add('floating');
        setTimeout(() => {
          channelElement.classList.remove('floating');
        }, 2000);
      }

      try {
        await supabase
          .from('channel_status')
          .upsert({
            channel_id: channelId,
            condition: condition,
            last_updated: new Date().toISOString()
          });
        
        // Update local data
        const channel = channels.find(c => c.id === channelId);
        if (channel) {
          channel.condition = condition;
          renderChannels();
          updateStats();
        }
      } catch (error) {
        console.error('Error updating condition:', error);
        alert('Failed to update channel condition. Please try again.');
        if (channelElement) {
          channelElement.classList.remove('floating');
        }
      }
    };

    function updateStats() {
      const stats = channels.reduce((acc, channel) => {
        acc[channel.condition] = (acc[channel.condition] || 0) + 1;
        if (channel.topic_available) {
          acc.topicAvailable = (acc.topicAvailable || 0) + 1;
        }
        
        const visitStatus = getVisitStatus(channel);
        if (visitStatus.status === 'warning') {
          acc.needVisit = (acc.needVisit || 0) + 1;
        }
        
        return acc;
      }, {});

      document.getElementById('greenCount').textContent = stats.green || 0;
      document.getElementById('yellowCount').textContent = stats.yellow || 0;
      document.getElementById('redCount').textContent = stats.red || 0;
      document.getElementById('topicAvailableCount').textContent = stats.topicAvailable || 0;
      document.getElementById('needVisitCount').textContent = stats.needVisit || 0;
    }

    // Initialize
    checkConnection();
    loadChannels();
    
    // Check connection and reload data every 30 seconds
    setInterval(() => {
      checkConnection();
      if (isConnected) {
        loadChannels();
      }
    }, 30000);
    
    // Check for expired visits every hour
    setInterval(() => {
      if (channels.length > 0) {
        updateVisitWarnings();
      }
    }, 60 * 60 * 1000);
  </script>
</body>
</html>
